<!DOCTYPE html>
<html lang="en">
<head>
  <title>Smart Dairy Control Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: 'Courier New', monospace;
      background: #0b0f14;
      color: #00ffcc;
    }

    header {
      background: #111820;
      padding: 15px;
      text-align: center;
      font-size: 26px;
      letter-spacing: 2px;
      border-bottom: 2px solid #00ffcc;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      padding: 10px 20px;
      font-size: 18px; /* Increased font size */
      background: #05080c;
    }

    .status { 
      font-weight: bold; 
      font-size: 20px; /* Increased font size */
    }
    .online { color: #00ff00; }
    .offline { color: red; }

    #date {
      font-size: 20px;
      font-weight: bold;
    }

    .panel {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      padding: 30px;
    }

    .unit {
      border: 2px solid #00ffcc;
      padding: 20px;
      background: #05080c;
      height: 150px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .label {
      font-size: 16px;
      color: #ccc;
      margin-bottom: 10px;
    }

    .value {
      font-size: 36px;
      font-weight: bold;
      color: #00ffcc;
    }

    footer {
      text-align: center;
      padding: 10px;
      font-size: 13px;
      color: #555;
    }
  </style>
</head>

<body>

<header>SENSORS - REAL TIME DATA</header>

<div class="top-bar">
  <div>DATE: <span id="date">--</span></div>
  <div class="status offline" id="status">STATUS: OFFLINE</div>
</div>

<div class="panel">
  <div class="unit"><div class="label">GAS</div><div class="value" id="gas">--</div></div>
  <div class="unit"><div class="label">SMOKE</div><div class="value" id="smoke">--</div></div>
  <div class="unit"><div class="label">SOUND</div><div class="value" id="sound">--</div></div>
  <div class="unit"><div class="label">LDR</div><div class="value" id="ldr">--</div></div>
  <div class="unit"><div class="label">IR</div><div class="value" id="ir">--</div></div>
  <div class="unit"><div class="label">CALL ALERT</div><div class="value" id="alert">--</div></div>
</div>

<footer>
  ESP32 LIVE DATA • GOOGLE SHEET SYNC • INDUSTRIAL MODE
</footer>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzE52v4LeSYU0JwRA2ELTwn-g85JO60TEZIWsNL7BjX7XTWlkOBEAW9UUqOekTw18F9rg/exec";

function update(id, value) {
  document.getElementById(id).innerText = value;
}

function loadData() {
  fetch(SCRIPT_URL)
    .then(res => res.json())
    .then(arr => {
      const data = arr[arr.length - 1];

      // ✅ CORRECT DATE HANDLING
      const rawDate = data.DATE;
      let parsedDate = new Date(rawDate);

      if (!isNaN(parsedDate)) {
        const day = String(parsedDate.getDate()).padStart(2, '0');
        const month = String(parsedDate.getMonth() + 1).padStart(2, '0');
        const year = parsedDate.getFullYear();
        update("date", `${day}/${month}/${year}`);
      } else {
        // fallback if parsing fails
        update("date", rawDate.split(" ")[0] || rawDate);
      }

      update("gas", data.GAS);
      update("smoke", data.SMOKE);
      update("sound", data.SOUND);
      update("ldr", data.LDR);
      update("ir", data.IR);
      update("alert", "AUTO");

      document.getElementById("status").innerText = "STATUS: ONLINE";
      document.getElementById("status").className = "status online";
    })
    .catch(() => {
      document.getElementById("status").innerText = "STATUS: OFFLINE";
      document.getElementById("status").className = "status offline";
    });
}

setInterval(loadData, 5000);
loadData();
</script>

</body>
</html>
