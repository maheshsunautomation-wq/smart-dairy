<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beautiful Task Scheduler</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(to right, #6a11cb, #2575fc);
    color: #fff;
    margin: 0;
    padding: 0;
  }
  h1 { text-align:center; margin:40px 0 20px 0; font-weight:700; font-size:36px; letter-spacing:1px; text-shadow:2px 2px 6px rgba(0,0,0,0.4); }
  #add-task-container { display:flex; justify-content:center; align-items:flex-start; gap:20px; flex-wrap:wrap; margin-bottom:40px; }
  #add-task-btn { font-size:32px; background:linear-gradient(145deg, #ff7e5f, #feb47b); color:#fff; border:none; width:60px; height:60px; border-radius:50%; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.3); transition:transform 0.3s ease, box-shadow 0.3s ease; }
  #add-task-btn:hover { transform: scale(1.15); box-shadow:0 10px 25px rgba(0,0,0,0.4); }
  #task-form { display:none; background:rgba(255,255,255,0.15); backdrop-filter:blur(15px); color:#fff; padding:25px; border-radius:20px; box-shadow:0 8px 25px rgba(0,0,0,0.3); max-width:300px; flex-grow:1; }
  #task-form input, #task-form select, #task-form textarea, #task-form button { width:100%; padding:12px; margin:10px 0; border-radius:12px; border:none; font-size:16px; box-sizing:border-box; background:rgba(255,255,255,0.2); color:#fff; backdrop-filter:blur(10px); outline:none; }
  #task-form textarea { resize:none; height:80px; }
  #task-form input::placeholder, #task-form textarea::placeholder { color:#eee; }
  #task-form select { color:#fff; }
  #task-form button { background:linear-gradient(145deg, #ff7e5f, #feb47b); color:#fff; font-weight:600; cursor:pointer; transition:transform 0.2s ease, box-shadow 0.2s ease; }
  #task-form button:hover { transform:translateY(-2px); box-shadow:0 6px 15px rgba(0,0,0,0.4); }
  table { width:90%; margin:0 auto 40px auto; border-collapse:collapse; background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border-radius:20px; overflow:hidden; box-shadow:0 8px 20px rgba(0,0,0,0.3); }
  th, td { padding:15px 20px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.2); font-weight:500; }
  th { background:rgba(255,255,255,0.2); }
  .delete-btn { background:#FF4136; color:#fff; border:none; padding:8px 12px; border-radius:12px; cursor:pointer; font-size:14px; font-weight:600; transition:transform 0.2s ease, background 0.2s ease; }
  .delete-btn:hover { background:#c1271c; transform:translateY(-1px); }
</style>
</head>

<body>

<h1>Task Scheduler</h1>

<div id="add-task-container">
  <button id="add-task-btn" onclick="toggleForm()">+</button>
  <div id="task-form">
    <input type="text" id="task-name" placeholder="Task Name">
    <input type="date" id="task-date">
    <input type="time" id="task-time">
    <select id="am-pm">
      <option value="AM">AM</option>
      <option value="PM">PM</option>
    </select>
    <textarea id="task-comment" placeholder="Comment"></textarea>
    <button onclick="addTask()">Submit</button>
  </div>
</div>

<table id="tasks-list">
  <thead>
    <tr>
      <th>Task Name</th>
      <th>Date</th>
      <th>Time</th>
      <th>AM/PM</th>
      <th>Comment</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwxtER68gaJlub3jdGGh2nhbGwpZoVVJIiajljgBgcTSL5iseMn7Sl31iGxb19n1nzp/exec";

// Toggle form
function toggleForm() {
  const form = document.getElementById('task-form');
  form.style.display = form.style.display === 'block' ? 'none' : 'block';
}

// Add task
function addTask(){
  const name = document.getElementById('task-name').value.trim();
  const date = document.getElementById('task-date').value;
  const time = document.getElementById('task-time').value;
  const ampm = document.getElementById('am-pm').value;
  const comment = document.getElementById('task-comment').value.trim();

  if(!name || !date || !time || !comment){
    alert('Please fill all fields');
    return;
  }

  fetch(scriptURL, {
    method:'POST',
    body: JSON.stringify({name,date,time,ampm,comment})
  })
  .then(res => res.text())
  .then(res=>{
    alert('Task submitted successfully');
    document.getElementById('task-form').style.display='none';
    
    // Clear form fields
    document.getElementById('task-name').value = '';
    document.getElementById('task-date').value = '';
    document.getElementById('task-time').value = '';
    document.getElementById('task-comment').value = '';
    document.getElementById('am-pm').value = 'AM';

    // Reload tasks immediately
    loadTasks();
  })
  .catch(err=>alert('Error: '+err));
}

// Convert date to DD.MM.YYYY
function formatDate(d) {
  if (!d) return "";
  const date = new Date(d);
  if (isNaN(date.getTime())) return d; // if invalid, return raw
  return String(date.getDate()).padStart(2, '0') + "." +
         String(date.getMonth() + 1).padStart(2, '0') + "." +
         date.getFullYear();
}

// Convert time to HH:MM
function formatTime(t) {
  if (!t) return "";
  const tm = new Date(t);
  if (isNaN(tm.getTime())) return t; // if invalid, return raw
  return String(tm.getHours()).padStart(2, '0') + ":" +
         String(tm.getMinutes()).padStart(2, '0');
}

// Load tasks
function loadTasks(){
  fetch(scriptURL+"?action=get")
  .then(res=>res.json())
  .then(data=>{
    const tbody = document.querySelector('#tasks-list tbody');
    tbody.innerHTML='';

    data.forEach(row=>{
      const tr = document.createElement('tr');
      tr.innerHTML=`
        <td>${row.name}</td>
        <td>${formatDate(row.date)}</td>
        <td>${formatTime(row.time)}</td>
        <td>${row.ampm}</td>
        <td>${row.comment}</td>
        <td><button class="delete-btn" onclick="deleteTask('${row.id}')">Delete</button></td>
      `;
      tbody.appendChild(tr);
    });
  });
}

// Delete task
function deleteTask(id){
  fetch(scriptURL+"?action=delete&id="+id)
  .then(res=>res.text())
  .then(res=>{
    alert('Task deleted');
    loadTasks();
  });
}

window.onload = loadTasks;
</script>

</body>
</html>
